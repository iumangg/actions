name: "Create GitHub pull request"
description: "Creates a pull request in the repository using GitHub CLI"

inputs:
  base_branch:
    description: "Base branch for the pull request"
    required: true
  head_branch:
    description: "Head branch for the pull request"
    required: true
  title:
    description: "Title for the pull request"
    required: true
  body:
    description: "Body for the pull request"
    required: false
    default: "This is an automated pull request generated by GitHub Actions."
  reviewer:
    description: "Reviewer for the pull request"
    required: false
    default: "${{ github.repository_owner }}"
  draft:
    description: "Create a draft pull request"
    required: false
    default: "false"

runs:
  using: "composite"
  steps:
    - name: Create GitHub pull request
      shell: bash
      run: |
        # Check if a open PR already exists
        if [ -n "$(gh pr list --base "${{ inputs.base_branch }}" --head "${{ inputs.head_branch }}" --state open --json number --jq '.[0].number')" ]; then
          echo "An open PR already exists. Skipping PR creation."
          exit 0
        fi
        gh pr create \
          --base "${{ inputs.base_branch }}" \
          --head "${{ inputs.head_branch }}" \
          --title "${{ inputs.title }}" \
          --body "${{ inputs.body }}" \
          --reviewer "${{ github.repository_owner }}" \
          $([[ "${{ inputs.draft }}" == "true" ]] && echo "--draft")
        echo "Pull Request created successfully."
